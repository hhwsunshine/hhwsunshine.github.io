<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png"><link rel="icon" type="image/png" href="/img/favicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="description" content=""><meta name="author" content="hhw"><meta name="keywords" content=""><title>Sphinx(斯芬克斯)文档概述 ~ hhw博客</title><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/5.10.2/css/all.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/mdbootstrap/4.8.9/css/mdb.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/3.0.1/github-markdown.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css"><link rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css"><meta name="generator" content="Hexo 4.2.0"></head><body><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/">&nbsp;<strong>hhwsunshine's blog</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/">首页</a></li><li class="nav-item"><a class="nav-link" href="/archives/">归档</a></li><li class="nav-item"><a class="nav-link" href="/tags/">标签</a></li><li class="nav-item"><a class="nav-link" href="/links/">友链</a></li><li class="nav-item"><a class="nav-link" href="/about/">关于</a></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i class="iconfont icon-search"></i>&nbsp;&nbsp;</a></li></ul></div></div></nav><div class="view intro-2" id="background" style="background:url(/img/post_page.png) no-repeat center center;background-size:cover;background-attachment:scroll"><div class="full-bg-img"><div class="mask rgba-black-light flex-center"><div class="container text-center white-text fadeInUp"><span class="h2" id="subtitle"></span><br><p class="mt-3"><i class="fas fa-calendar-alt" aria-hidden="true"></i>&nbsp; 星期三, 一月 15日 2020, 9:16 上午</p><p>&nbsp;<i class="far fa-chart-bar"></i> <span class="post-count">2.3k 字 </span>&nbsp; &nbsp;<i class="far fa-clock"></i> <span class="post-count">11 分钟 </span>&nbsp; &nbsp;<i class="far fa-eye" aria-hidden="true"></i>&nbsp; <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span> 次 </span>&nbsp;</p></div></div></div></div></header><main><div class="container-fluid"><div class="row"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-md"><div class="py-5 z-depth-3" id="board"><div class="post-content mx-auto" id="post"><div class="markdown-body"><h1 id="一-前言"><a href="#一-前言" class="headerlink" title="一 前言"></a>一 前言</h1><p>写文档是开发人员日常工作中的一项重要内容，除了word之外，我更偏爱使用标记语言(Markup Language)。使用标记语言，可以利用简单、免费的文本编辑器(记事本，vim, emacs…）编写文档并设置格式，再生成html或pdf等格式，或者直接把编辑好的文件传到github或wiki上面 ，通过浏览器可以直接查看带有格式的文档。</p><p>目前标记语言主要有两种，Markdown和reStructuredText（简称reST)。该使用哪一种是一个见仁见智的选择，我在这里就不比较它们（包括其他标记语言）的优劣了，感兴趣的可以参考：</p><p><a href="https://www.zhihu.com/question/19851600" target="_blank" rel="noopener">知乎：Org-mode、reST、 Markdown (各有什么优缺点？)</a></p><p>很多开源项目的文档就是用sphinx+reST做的，那么该如何安装和使用呢？详见下文</p><h1 id="二-安装软件包"><a href="#二-安装软件包" class="headerlink" title="二 安装软件包"></a>二 安装软件包</h1><p>使用sphinx+reST编写文档，需要安装一些软件包</p><pre><code>sudo apt-get install python-pip
sudo pip install -U Sphinx</code></pre><p>如果要从代码注释生成API文档，需要安装doxygen和breathe插件，后者可以让sphinx处理doxygen生成的xml:</p><pre><code>sudo apt-get install doxygen
sudo pip install breathe</code></pre><p>如果要生成pdf文件，需要安装texlive:</p><pre><code>sudo apt-get install texlive-full</code></pre><p>如果要生成中文pdf，则需要确认安装了必要的东亚语言和字体包，比如texlive-lang-cjk和texlive-fonts-recommended，可以参考<a href="http://www.tuicool.com/articles/nAJJVb" target="_blank" rel="noopener">http://www.tuicool.com/articles/nAJJVb</a> 。　　</p><h1 id="三-项目建立"><a href="#三-项目建立" class="headerlink" title="三 项目建立"></a>三 项目建立</h1><p>最简单的方法是建立工作目录后（这里是doc），在其中运行sphinx-quickstart(终端执行)。运行此命令后sphinx会问你一些问题，根据情况回答即可。在这里我建立了一个名为foo的Project，版本是1.0，作者名为zzq，将source与build目录放开，其他都选默认：</p><pre><code>sphinx-quickstart 
Welcome to the Sphinx 1.3.3 quickstart utility.

Please enter values for the following settings (just press Enter to
accept a default value, if one is given in brackets).

Enter the root path for documentation.
&gt; Root path for the documentation [.]: 

You have two options for placing the build directory for Sphinx output.
Either, you use a directory &quot;_build&quot; within the root path, or you separate
&quot;source&quot; and &quot;build&quot; directories within the root path.
&gt; Separate source and build directories (y/n) [n]: y

Inside the root directory, two more directories will be created; &quot;_templates&quot;
for custom HTML templates and &quot;_static&quot; for custom stylesheets and other static
files. You can enter another prefix (such as &quot;.&quot;) to replace the underscore.
&gt; Name prefix for templates and static dir [_]: 

The project name will occur in several places in the built documentation.
&gt; Project name: foo
&gt; Author name(s): zzq

Sphinx has the notion of a &quot;version&quot; and a &quot;release&quot; for the
software. Each version can have multiple releases. For example, for
Python the version is something like 2.5 or 3.0, while the release is
something like 2.5.1 or 3.0a1.  If you don&#39;t need this dual structure,
just set both to the same value.
&gt; Project version: 1.0
&gt; Project release [1.0]: 

If the documents are to be written in a language other than English,
you can select a language here by its language code. Sphinx will then
translate text that it generates into that language.

For a list of supported codes, see
http://sphinx-doc.org/config.html#confval-language.
&gt; Project language [en]: 

The file name suffix for source files. Commonly, this is either &quot;.txt&quot;
or &quot;.rst&quot;.  Only files with this suffix are considered documents.
&gt; Source file suffix [.rst]: 

One document is special in that it is considered the top node of the
&quot;contents tree&quot;, that is, it is the root of the hierarchical structure
of the documents. Normally, this is &quot;index&quot;, but if your &quot;index&quot;
document is a custom template, you can also set this to another filename.
&gt; Name of your master document (without suffix) [index]: 

Sphinx can also add configuration for epub output:
&gt; Do you want to use the epub builder (y/n) [n]: 

Please indicate if you want to use one of the following Sphinx extensions:
&gt; autodoc: automatically insert docstrings from modules (y/n) [n]: 
&gt; doctest: automatically test code snippets in doctest blocks (y/n) [n]: 
&gt; intersphinx: link between Sphinx documentation of different projects (y/n) [n]: 
&gt; todo: write &quot;todo&quot; entries that can be shown or hidden on build (y/n) [n]: 
&gt; coverage: checks for documentation coverage (y/n) [n]: 
&gt; pngmath: include math, rendered as PNG images (y/n) [n]: 
&gt; mathjax: include math, rendered in the browser by MathJax (y/n) [n]: 
&gt; ifconfig: conditional inclusion of content based on config values (y/n) [n]: 
&gt; viewcode: include links to the source code of documented Python objects (y/n) [n]: 

A Makefile and a Windows command file can be generated for you so that you
only have to run e.g. `make html&#39; instead of invoking sphinx-build
directly.
&gt; Create Makefile? (y/n) [y]: 
&gt; Create Windows command file? (y/n) [y]: 

Creating file ./source/conf.py.
Creating file ./source/index.rst.
Creating file ./Makefile.
Creating file ./make.bat.

Finished: An initial directory structure has been created.

You should now populate your master file ./source/index.rst and create other documentation
source files. Use the Makefile to build the docs, like so:
   make builder
where &quot;builder&quot; is one of the supported builders, e.g. html, latex or linkcheck.

~/doc$ </code></pre><p>执行完以上命令上doc目录中有以下内容（根据执行sphinx-quickstart命令时对各问题的回答不同，下文的文件内容和文件名可能有所不同）：</p><pre><code>build  make.bat  Makefile  source</code></pre><p>其中source和build分别是源文件和编译生成文件的存放目录，Makefile和make.bat分别是Linux和Windows下的makefile。</p><p>source目录下有以下内容：</p><pre><code>conf.py  index.rst  _static  _templates</code></pre><p>其中conf.py是配置文件，index.rst是主框架文件，_static是静态文件存放目录，比如可以放一些图片什么的，_templates是模板存放目录。</p><p>我们先创建2个文件intro.rst和sample.rst，在里面只写标题。这两个文件的内容分别是<br>intro.rst:</p><pre><code>intro
=====</code></pre><p>sample.rst:</p><pre><code>sample
======</code></pre><p>然后编辑index.rst，在toctree指导语句（directive）中加入刚才两个文件的文件名，后缀省略，路径是相对于源目录source的：</p><pre><code>Welcome to foo&#39;s documentation!                                    
===============================                                    

Contents:                                                          

.. toctree::                                                       
   :maxdepth: 2                                                    

   intro                                                           
   sample                                                          
</code></pre><p>此时，可以回到source的上一级目录（有Makefile的目录），运行make html，即可在build目录中生成HTML文件：</p><pre><code>~/doc/source$ cd ..
~/doc$ make html
sphinx-build -b html -d build/doctrees   source build/html
Running Sphinx v1.3.3
loading pickled environment... done
building [mo]: targets for 0 po files that are out of date
building [html]: targets for 2 source files that are out of date
updating environment: 0 added, 2 changed, 0 removed
reading sources... [100%] sample                                                                                      
looking for now-outdated files... none found
pickling environment... done
checking consistency... done
preparing documents... done
writing output... [100%] sample                                                                                       
generating indices... genindex
writing additional pages... search
copying static files... done
copying extra files... done
dumping search index in English (code: en) ... done
dumping object inventory... done
build succeeded.

Build finished. The HTML pages are in build/html.</code></pre><p>编译成功后使用浏览器打开build/html目录下的index.html，是这样的：</p><p><img src="/img/content/sphinx/1.png" srcset="/img/loading.gif" alt=""></p><p>到此，一次典型的环境配置与html生成步骤就完成了。</p><p>如果觉得生成的html主题风格自己不喜欢，可以个性source/conf.py，找到</p><pre><code># The theme to use for HTML and HTML Help pages.  See the documentation for
# a list of builtin themes.                                     
html_theme = &#39;alabaster&#39;</code></pre><p>把alabaster改成其他主题名就好了 。内置的主题有不少，见：<a href="http://sphinx-doc.org/theming.html#builtin-themes" target="_blank" rel="noopener">http://sphinx-doc.org/theming.html#builtin-themes</a></p><h1 id="四-conf-py配置"><a href="#四-conf-py配置" class="headerlink" title="四 conf.py配置"></a>四 conf.py配置</h1><h2 id="4-1-主题样式"><a href="#4-1-主题样式" class="headerlink" title="4.1 主题样式"></a>4.1 主题样式</h2><p>设置alabaster主题只需在html_theme中设置名字即可:</p><p>html_theme = ‘alabaster’<br>而要设置更美观的sphinx_rtd_theme主题，需要在文件头部加上:</p><p>import sphinx_rtd_theme<br>再设置html_theme:</p><p>html_theme = ‘sphinx_rtd_theme’</p><h2 id="4-2-LOGO"><a href="#4-2-LOGO" class="headerlink" title="4.2 LOGO"></a>4.2 LOGO</h2><p>在html_logo中设置图片文件路径:</p><p>html_logo = ‘./logo.png’</p><h2 id="4-3-不显示源文件链接"><a href="#4-3-不显示源文件链接" class="headerlink" title="4.3 不显示源文件链接"></a>4.3 不显示源文件链接</h2><p>默认会在生成的html页中显示rst源文件链接，做如下设置后不显示:</p><p>html_show_sourcelink = False</p><h1 id="五-Index页配置"><a href="#五-Index页配置" class="headerlink" title="五 Index页配置"></a>五 Index页配置</h1><p>主要是设置目录树:</p><pre><code>.. toctree::
    :maxdepth: 3
    :numbered:

    foo
    bar</code></pre><p>maxdepth把index.html页中目录的标题显示深度限制设为3，numbered为编号。之后空一行，在下面列出各子文档，可以不加文件后缀。</p><p>注意：这里同样要注意代码对齐。</p><h1 id="六-生成API文档"><a href="#六-生成API文档" class="headerlink" title="六 生成API文档"></a>六 生成API文档</h1><p>可以配合使用sphinx+reST+breathe+doxygen来给代码生成API文档并无缝添加到已有的文档结构中。</p><h2 id="6-1-Step1"><a href="#6-1-Step1" class="headerlink" title="6.1 Step1"></a>6.1 Step1</h2><p>运行:</p><p>doxygen -g<br>生成doxygen配置文件(默认文件名是Doxyfile)，然后修改此文件：</p><ul><li>项目名称 PROJECT_NAME = “MyProject”</li><li>对C项目优化 OPTIMIZE_OUTPUT_FOR_C = YES</li><li>源文件路径 INPUT = /home/tom/project/include</li><li>源文件编码 INPUT_ENCODEING = UTF-8</li><li>生成XML GENERATE_XML = YES 因为要使用breathe扩展，所以必须生成xml</li><li>XML输出目录 XML_OUTPUT = my_xml</li><li>不需要生成html GENERATE_HTML = NO</li><li>不需要生成latex GENERATE_LATEX = NO</li><li>不显示包含文件 SHOW_INCLUDE_FILES = NO</li></ul><h2 id="6-2-Step2"><a href="#6-2-Step2" class="headerlink" title="6.2 Step2"></a>6.2 Step2</h2><p>运行:</p><p>doxygen [Doxyfile]<br>输出注释，主要是xml。</p><h2 id="6-3-Step3"><a href="#6-3-Step3" class="headerlink" title="6.3 Step3"></a>6.3 Step3</h2><p>配置conf.py，以支持breathe扩展。前提是这一扩展已经安装。</p><p>加入扩展:</p><p>extensions = [‘breathe’]<br>配置breathe:</p><pre><code>breathe_projects = { &quot;myproject&quot;: &quot;./my_xml&quot; }
breathe_default_project = &quot;myproject&quot;
breathe_domain_by_extension = {&quot;h&quot; : &quot;c&quot;}</code></pre><h2 id="6-4-Step4"><a href="#6-4-Step4" class="headerlink" title="6.4 Step4"></a>6.4 Step4</h2><p>按breathe扩展语法编写rst文件，比如:</p><pre><code>My API
==========

sp.h
----

.. doxygenfile:: sp.h</code></pre><p>上面的语句为项目中的sp.h接口文件生成了html文档。</p><p>最后，运行 make html 生成html即可。</p><p>在这些步骤中，需要先调用doxygen生成xml，再调用sphinx-build(make html时自动调用)生成最终文档，如果想一步完成，可以在Makefile中加入doxygen调用:</p><pre><code>html:
    doxygen Doxyfile
    $(SPHINXBUILD) -b html $(ALLSPHINXOPTS) $(BUILDDIR)/html
    @echo
    @echo &quot;Build finished. The HTML pages are in $(BUILDDIR)/html.&quot;</code></pre><h1 id="七-生成PDF"><a href="#七-生成PDF" class="headerlink" title="七 生成PDF"></a>七 生成PDF</h1><p>生成PDF的前提是安装了texlive，如果要生成中文PDF，还需要确认安装了东亚语言包和字体包(texlive-lang-cjk, texlive-fonts-recommands之类）。</p><p>然后配置conf.py，在latex_elements中加入:</p><pre><code>latex_elements = {
# The paper size (&#39;letterpaper&#39; or &#39;a4paper&#39;).
#&#39;papersize&#39;: &#39;letterpaper&#39;,

# The font size (&#39;10pt&#39;, &#39;11pt&#39; or &#39;12pt&#39;).
#&#39;pointsize&#39;: &#39;10pt&#39;,

# Additional stuff for the LaTeX preamble.
&#39;preamble&#39;: &#39;&#39;&#39;
\\hypersetup{unicode=true}
\\usepackage{CJKutf8}
\\AtBeginDocument{\\begin{CJK}{UTF8}{gbsn}}
\\AtEndDocument{\\end{CJK}}
&#39;&#39;&#39;,</code></pre><p>最后运行 make latexpdf 即可。</p><h1 id="八-reST语法介绍"><a href="#八-reST语法介绍" class="headerlink" title="八 reST语法介绍"></a>八 reST语法介绍</h1><p>reStructuredText标记语言比Makedown强大很多，支持多种排版样式。不过这里只介绍开发人员主要会用到的一些样式。reST文档的详细介绍见<a href="http://docutils.sourceforge.net/rst.html" target="_blank" rel="noopener">http://docutils.sourceforge.net/rst.html</a></p><h1 id="九-参考"><a href="#九-参考" class="headerlink" title="九 参考"></a>九 参考</h1><p><a href="https://www.sphinx-doc.org/en/master/" target="_blank" rel="noopener">sphinx-doc官网</a><br><a href="https://docutils.sourceforge.io/docs/ref/rst/restructuredtext.html" target="_blank" rel="noopener">reStructuredText标记规范</a><br>转文： <a href="https://www.cnblogs.com/zzqcn/p/5096876.html" target="_blank" rel="noopener">https://www.cnblogs.com/zzqcn/p/5096876.html</a></p><hr></div><br><div><p><span><i class="iconfont icon-tag"></i> <a class="hover-with-bg" href="/tags/sphinx">sphinx</a></span></p><p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="nofollow noopener noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p></div></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container"><div id="toc"><p class="h4"><i class="far fa-list-alt"></i>&nbsp;目录</p><div id="tocbot"></div></div></div></div></div><div class="col-lg-7 mx-auto nopadding-md"><div class="container comments mx-auto" id="comments"></div></div></main><a class="z-depth-1" id="scroll-top-button" href="#" role="button"><i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div><footer class="mt-5"><div class="text-center py-3"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><b>Fluid</b></a><br>&nbsp;<span id="busuanzi_container_site_pv"></span>总访问量 <span id="busuanzi_value_site_pv"></span> 次&nbsp; &nbsp;<span id="busuanzi_container_site_uv"></span>总访客数 <span id="busuanzi_value_site_uv"></span> 人&nbsp;<br></div></footer><script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script><script src="https://cdn.staticfile.org/popper.js/1.15.0/umd/popper.min.js"></script><script src="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script><script src="https://cdn.staticfile.org/mdbootstrap/4.8.9/js/mdb.min.js"></script><script src="/js/main.js"></script><script src="/js/lazyload.js"></script><script src="https://cdn.staticfile.org/tocbot/4.8.0/tocbot.min.js"></script><script src="/js/post.js"></script><script src="https://cdn.staticfile.org/smoothscroll/1.4.10/SmoothScroll.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.staticfile.org/prettify/r298/prettify.min.js"></script><script>$(document).ready(function(){$("pre").addClass("prettyprint  linenums"),prettyPrint()})</script><script src="https://cdn.staticfile.org/typed.js/2.0.10/typed.min.js"></script><script>var typed=new Typed("#subtitle",{strings:["  ","Sphinx(斯芬克斯)文档概述&nbsp;"],cursorChar:"_",typeSpeed:70,loop:!1});typed.stop(),$(document).ready(function(){$(".typed-cursor").addClass("h2"),typed.start()})</script><script src="https://cdn.staticfile.org/anchor-js/4.2.0/anchor.min.js"></script><script>anchors.options = {
      placement: "right",
      visible: "false",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))</script><script src="/js/local-search.js"></script><script>var path="/local-search.xml",inputArea=document.querySelector("#local-search-input");inputArea.onclick=function(){getSearchFile(path),this.onclick=null}</script><script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script><script>$("#post img:not(.no-zoom img, img[no-zoom])").each(function(){var t=document.createElement("a");$(t).attr("data-fancybox","images"),$(t).attr("href",$(this).attr("src")),$(this).wrap(t)})</script></body></html>